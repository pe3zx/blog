<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        Hunting Attack Campaigns Exploiting VPN Vulnerabilities ::
        Pandora&#39;s Box
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="This post originally available on Intelligent Response Encyclopedia (IRE) but it seems to be useful and be a good example as an experimental hunting use case, so I decide to publish here with new updates from National Cyber Security Centre.
Threat Intelligence Vulnerabilities According to Volexity&amp;rsquo;s article, CVE-2019-11510 was used to attack vulnerable Pulse Secure SSL VPN server in order to arbitrarily access VPN configuration and sensitive files. Exploitation phase involves sending off a crafted request, the following example shows the request with target filename (/etc/passwd/) the attacker intended to read."
/>
<meta
  name="keywords"
  content="Blog by P. Boonyakarn"
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://pandora.sh/posts/hunting-attack-campaigns-exploit-vpn-vuln/" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>


<link rel="stylesheet" href="https://pandora.sh/assets/style.css" />

<link rel="stylesheet" href="https://pandora.sh/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="https://pandora.sh/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="https://pandora.sh/img/favicon.png" />


<link href="https://pandora.sh/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://pandora.sh/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://pandora.sh/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://pandora.sh/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://pandora.sh/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://pandora.sh/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Hunting Attack Campaigns Exploiting VPN Vulnerabilities"/>
<meta name="twitter:description" content="This post originally available on Intelligent Response Encyclopedia (IRE) but it seems to be useful and be a good example as an experimental hunting use case, so I decide to publish here with new updates from National Cyber Security Centre."/>



<meta property="og:title" content="Hunting Attack Campaigns Exploiting VPN Vulnerabilities" />
<meta property="og:description" content="This post originally available on Intelligent Response Encyclopedia (IRE) but it seems to be useful and be a good example as an experimental hunting use case, so I decide to publish here with new updates from National Cyber Security Centre." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://pandora.sh/posts/hunting-attack-campaigns-exploit-vpn-vuln/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-10T12:45:00+07:00" />
<meta property="article:modified_time" content="2019-10-10T12:45:00+07:00" /><meta property="og:site_name" content="Pandora&#39;s Box" />







  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >PANDORA&#39;S BOX</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/archive">Archive</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/archive">Archive</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">Hunting Attack Campaigns Exploiting VPN Vulnerabilities</h1>
    <div class="post-meta">
      
        <span class="post-date">
          2019-10-10
        </span>

        
          
        
      

      
        <span class="post-author"
          >— Written by P. Boonyakarn</span
        >


      
    </div>

    

    

    <div class="post-content">
      
      <p>This post originally available on <strong>Intelligent Response Encyclopedia (IRE)</strong> but it seems to be useful and be a good example as an experimental hunting use case, so I decide to publish here with new updates from <a href="https://www.ncsc.gov.uk/news/alert-vpn-vulnerabilities">National Cyber Security Centre</a>.</p>
<h2 id="threat-intelligence">Threat Intelligence</h2>
<h3 id="vulnerabilities">Vulnerabilities</h3>
<p>According to <a href="https://www.volexity.com/blog/2019/09/11/vulnerable-private-networks-corporate-vpns-exploited-in-the-wild/">Volexity&rsquo;s article</a>, <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11510">CVE-2019-11510</a> was used to attack vulnerable Pulse Secure SSL VPN server in order to arbitrarily access VPN configuration and sensitive files. Exploitation phase involves sending off a crafted request, the following example shows the request with target filename (<code>/etc/passwd/</code>) the attacker intended to read.</p>
<pre tabindex="0"><code>&lt;target-host&gt;/dana-na/../dana/html5acc/guacamole/../../../../../../etc/passwd?/dana/html5acc/guacamole/
</code></pre><p>With this vulnerability, the attacker can access a VPN session database and credentials either hashed or in plaintext from the device&rsquo;s cache. As described by <a href="https://www.ncsc.gov.uk/news/alert-vpn-vulnerabilities">National Cyber Security Centre</a>, the threat actors have also used the same kind of vulnerabilities to target other VPN products. The exploits of these vulnerabilities are publicly online and can be identified with the following CVEs:</p>
<ul>
<li>Pulse Connect Secure:
<ul>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11510">CVE-2019-11510</a>: Pre-auth arbitrary file reading</li>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11539">CVE-2019-11539</a>: Post-auth command injection</li>
</ul>
</li>
<li>Fortinet:
<ul>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-13379">CVE-2018-13379</a>: Pre-auth arbitrary file reading</li>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-13382">CVE-2018-13382</a>: Allows an unauthenticated attacker to change the password of an SSL VPN web portal user.</li>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-13383">CVE-2018-13383</a>: Post-auth heap overflow. This allows an attacker to gain a shell running on the router.</li>
</ul>
</li>
<li>Palo Alto:
<ul>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-1579">CVE-2019-1579</a>: Palo Alto Networks GlobalProtect Portal</li>
</ul>
</li>
</ul>
<h3 id="malware">Malware</h3>
<p>No malware is identified in this operation.</p>
<h3 id="tactics-techniques-and-procedures">Tactics, Techniques, and Procedures</h3>
<h4 id="cve-2019-11510">CVE-2019-11510</h4>
<p>The attack will conduct the following activities on their operation:</p>
<ol>
<li>Validating the existence of the vulnerability by trying to access <code>/etc/passwd</code> and <code>/etc/hosts</code> with the exploit</li>
<li>If the device is vulnerable, the attacker might try to access data on the following location:
<ol>
<li>Users session database on <code>/data/runtime/mtmp/lmdb/randomVal/data.mdb</code></li>
<li>Cached credentials on <code>/data/runtime/mtmp/lmdb/data/data.mdb</code></li>
<li>Hashed users credentials on <code>/data/runtime/mtmp/system</code></li>
</ol>
</li>
<li>With the obtained credentials, the attacker can reuse the credentials to create a VPN tunnel and access the internal network</li>
</ol>
<p>2-factor authentication will not prevent the hijacking of a valid authentication session.</p>
<h3 id="indicators-of-compromise">Indicators of Compromise</h3>
<p>See mroe on <a href="https://www.volexity.com/blog/2019/09/11/vulnerable-private-networks-corporate-vpns-exploited-in-the-wild/">Network Indicators</a></p>
<h2 id="hypothesis-proposal">Hypothesis Proposal</h2>
<h3 id="pulse-secure-ssl-vpn-cve-2019-11510-and-cve-2019-11539">Pulse Secure SSL VPN: CVE-2019-11510 and CVE-2019-11539</h3>
<p>To efficiently gain the visibility required for this attack scenario, we need to enable a feature on Pulse Secure VPN to record unauthenticated web requests for hunting which isn&rsquo;t turn on by default. This can be done via <code>System -&gt; Log/Monitoring -&gt; User Access -&gt; Settings</code> and select <code>Unauthenticated Requests</code>.</p>
<p>When the unauthenticated web requests logging feature is enabled, we can identify the attack by focusing on request to the vulnerable path with an existing of a file name, for example, an attempt to access <code>/data/runtime/mtmp/lmdb/randomVal/data.mdb</code> will look like this</p>
<pre tabindex="0"><code>info – [x.x.x.x] – System()[][] – 2019/08/14 09:15:26 – VPN-Remote – Connection from IP x.x.x.x not authenticated yet (URL=/dana-na/../dana/html5acc/guacamole/../../../../../../../data/runtime/mtmp/lmdb/randomVal/data.mdb?/dana/html5acc/guacamole/)
</code></pre><p>If this request is identified, we can assume that the attacker already accessed an unknown amount of credentials and then can identify potential behavior that may relate to session hijacking by examining Pulse Secure VPN logs for suspicious changes of IP addresses.</p>
<pre tabindex="0"><code>2019-08-14 09:35:32 – PulseSecure – [1.2.3.4] DOMAIN\username – Remote address for user DOMAIN\username changed from 1.2.3.4 to 5.6.7.8.
2019-08-14 09:38:56 – PulseSecure – [1.2.3.4] DOMAIN\username – Remote address for user DOMAIN\username changed from 5.6.7.8 to ...
</code></pre><p>For CVE-2019-11539, we can identify an attempt to exploit the vulnerability by searching for requests to <code>/dana-admin/diag/diag.cgi</code> with an options= parameter in the URL.</p>
<h3 id="fortinet-cve-2018-13379-cve-2018-13382-and-cve-2018-13383">Fortinet: CVE-2018-13379, CVE-2018-13382, and CVE-2018-13383</h3>
<p>To identify an attack, we need to make sure that the device is configured to log web requests. By the way, either firewall logs or netflow logs is also possible to identify the attack.</p>
<p>According to <a href="https://www.ncsc.gov.uk/news/alert-vpn-vulnerabilities">National Cyber Security Centre</a>, When exploiting CVE-2018-13379, an attacker may download sslvpn_websession, which contains the usernames and passwords of active users. This file is typically at least 200 KB. Searching firewall, or netflow logs, for TCP sessions with 200,000-250,000 bytes from the SSL VPN device&rsquo;s web interface port to the client, and a small number of bytes (less than 2,000) from the client, may return evidence of exploitation.</p>
<h2 id="additional-information">Additional Information</h2>
<ul>
<li>Exploit for CVE-2019-11510 by <a href="https://know.bishopfox.com/blog/breaching-the-trusted-perimeter">Bishop Fox</a></li>
</ul>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://pandora.sh/posts/usage-logging-at-internet-cafe/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Usage Logging at Internet Cafe</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://pandora.sh/posts/lesson-learned-from-anu-data-breach/">
                  <span class="button__text">Lesson Learned From Australian National University (ANU) Data Breach Incident Report</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">P. Boonyakarn © 2018 - 2021 CC-BY</div>
      <span>
        <a href="https://webring.wonderful.software#pandora.sh" title="วงแหวนเว็บ" target="_blank" rel="noopener">
          <img src="/img/webring.svg" width="20px" height="20px" alt="วงแหวนเว็บ" />
        </a>
      </span>
      
  </div>
</footer>

<script src="https://pandora.sh/assets/main.js"></script>
<script src="https://pandora.sh/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
